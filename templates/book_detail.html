{% extends "base.html" %}

{% block content %}
<div class="book-detail-container">
    <div class="book-detail-header">
        <div class="book-image-section">
            <img src="{{ book.image_url }}" alt="{{ book.title }}" class="book-detail-image">
        </div>
        
        <div class="book-info-section">
            <h1>{{ book.title }}</h1>
            <h2>Tác giả: {{ book.author }}</h2>
            
            <div class="book-rating">
                {% for i in range(1, 6) %}
                    <span class="star {{ 'active' if i <= avg_rating|round|int else '' }}">★</span>
                {% endfor %}
                <span class="rating-text">({{ avg_rating|round(1) }}/5 - {{ reviews|length }} đánh giá)</span>
            </div>
            
            <div class="book-price">
                {{ '{:,.0f}'.format(book.price) }}đ
            </div>
            
            <div class="book-stock">
                Còn hàng: {{ book.stock }} quyển
            </div>
            
            <div class="book-description">
                <h3>Mô tả</h3>
                <p>{{ book.description }}</p>
            </div>
            
            <div class="book-actions">
                <a href="{{ url_for('add_to_cart', book_id=book.id) }}" class="btn btn-primary">
                    Thêm vào giỏ hàng
                </a>
            </div>
        </div>
    </div>
    
    <div class="book-review-section">
        <h2>Đánh giá sách</h2>
        
        {% if user_purchased %}
        <div class="review-form">
            <form action="{{ url_for('add_book_review', book_id=book.id) }}" method="POST">
                <div class="rating-input">
                    {% for i in range(5, 0, -1) %}
                    <input type="radio" name="rating" value="{{ i }}" id="star{{ i }}">
                    <label for="star{{ i }}">★</label>
                    {% endfor %}
                </div>
                <textarea name="comment" placeholder="Nhận xét của bạn về cuốn sách"></textarea>
                <button type="submit" class="btn btn-primary">Gửi đánh giá</button>
            </form>
        </div>
        {% endif %}
        
        <div class="review-list">
            {% for review in reviews %}
            <div class="review-card">
                <div class="review-header">
                    <span class="reviewer-name">{{ review.user.username }}</span>
                    <div class="review-rating">
                        {% for i in range(1, 6) %}
                            <span class="star {{ 'active' if i <= review.rating else '' }}">★</span>
                        {% endfor %}
                    </div>
                </div>
                <div class="review-body">
                    <p>{{ review.comment }}</p>
                </div>
                <div class="review-footer">
                    {{ review.created_at.strftime('%d/%m/%Y %H:%M') }}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    {% if related_books %}
    <div class="related-books">
        <h3>Sách liên quan</h3>
        <div class="related-books-grid">
            {% for related_book in related_books %}
            <div class="book-card">
                <a href="{{ url_for('book_detail', book_id=related_book.id) }}">
                    <img src="{{ related_book.image_url }}" alt="{{ related_book.title }}" class="book-image">
                    <h3>{{ related_book.title }}</h3>
                    <p>{{ related_book.author }}</p>
                    <div class="price">{{ '{:,.0f}'.format(related_book.price) }}đ</div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}