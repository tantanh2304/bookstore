{% extends "base.html" %}

{% block title %}Chi tiết đơn hàng #{{ order.id }} - Tiệm Sách Rozy{% endblock %}

{% block content %}
<div class="order-detail-container">
    <div class="back-link">
        <a href="{{ url_for('my_orders') }}">
            <i class="fas fa-arrow-left"></i> Quay lại danh sách
        </a>
    </div>
    
    <div class="order-detail-header">
        <div class="order-id-section">
            <h2><i class="fas fa-receipt"></i> Đơn hàng #{{ order.id }}</h2>
            <div class="order-status status-{{ order.status }}">
                {% if order.status == 'pending' %}
                    <i class="fas fa-clock"></i> Đang xử lý
                {% elif order.status == 'completed' %}
                    <i class="fas fa-check-circle"></i> Hoàn thành
                {% elif order.status == 'cancelled' %}
                    <i class="fas fa-times-circle"></i> Đã hủy
                {% else %}
                    <i class="fas fa-shipping-fast"></i> Đang giao
                {% endif %}
            </div>
        </div>
        <div class="order-date-section">
            <i class="far fa-calendar-alt"></i>
            <span>{{ order.created_at.strftime('%d/%m/%Y %H:%M') }}</span>
        </div>
    </div>
    
    <div class="order-detail-content">
        <div class="detail-section">
            <h3><i class="fas fa-box"></i> Sản phẩm đã mua</h3>
            <div class="items-box">
                {% for item in order.items.split(', ') %}
                <div class="item-row">
                    <i class="fas fa-book"></i>
                    <span>{{ item }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="detail-section">
            <h3><i class="fas fa-money-bill-wave"></i> Thông tin thanh toán</h3>
            <div class="payment-info">
                <div class="info-row">
                    <span>Tổng tiền:</span>
                    <strong class="total-amount">{{ "{:,.0f}".format(order.total) }} đ</strong>
                </div>
                <div class="info-row">
                    <span>Phương thức:</span>
                    <span class="payment-method">
                        <i class="fas fa-credit-card"></i> Thanh toán khi nhận hàng
                    </span>
                </div>
            </div>
        </div>
        
        <div class="detail-section timeline-section">
            <h3><i class="fas fa-history"></i> Lịch sử đơn hàng</h3>
            <div class="timeline">
                <div class="timeline-item completed">
                    <div class="timeline-icon">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="timeline-content">
                        <strong>Đơn hàng đã được tạo</strong>
                        <span>{{ order.created_at.strftime('%d/%m/%Y %H:%M') }}</span>
                    </div>
                </div>
                
                {% if order.status in ['completed', 'shipped', 'cancelled'] %}
                <div class="timeline-item {% if order.status != 'cancelled' %}completed{% endif %}">
                    <div class="timeline-icon">
                        <i class="fas {% if order.status == 'cancelled' %}fa-times{% else %}fa-check{% endif %}"></i>
                    </div>
                    <div class="timeline-content">
                        {% if order.status == 'cancelled' %}
                        <strong>Đơn hàng đã hủy</strong>
                        {% else %}
                        <strong>Đang xử lý</strong>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                
                {% if order.status in ['completed', 'shipped'] %}
                <div class="timeline-item completed">
                    <div class="timeline-icon">
                        <i class="fas fa-shipping-fast"></i>
                    </div>
                    <div class="timeline-content">
                        <strong>Đang vận chuyển</strong>
                    </div>
                </div>
                {% endif %}
                
                {% if order.status == 'completed' %}
                <div class="timeline-item completed">
                    <div class="timeline-icon">
                        <i class="fas fa-box-open"></i>
                    </div>
                    <div class="timeline-content">
                        <strong>Đã giao hàng thành công</strong>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="order-actions">
        <a href="{{ url_for('index') }}" class="btn">
            <i class="fas fa-shopping-cart"></i> Tiếp tục mua sắm
        </a>
        {% if order.status == 'pending' %}
        <button class="btn btn-danger" onclick="alert('Vui lòng liên hệ với truclinh@gmail.com để hủy đơn hàng')">
            <i class="fas fa-times"></i> Yêu cầu hủy đơn
        </button>
        {% endif %}
    </div>
</div>

{% endblock %}