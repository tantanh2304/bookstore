{% extends "base.html" %}

{% block content %}
<div class="admin-header">
    <h2>📋 Quản lý tài khoản</h2>
    <a href="{{ url_for('admin') }}" class="btn">← Quay lại Dashboard</a>
</div>

<div class="stats-summary">
    <div class="stat-card">
        <h3>{{ users|length }}</h3>
        <p>Tổng người dùng</p>
    </div>
    <div class="stat-card">
        <h3>{{ users|selectattr('is_active')|list|length }}</h3>
        <p>Đang hoạt động</p>
    </div>
    <div class="stat-card">
        <h3>{{ users|selectattr('is_admin')|list|length }}</h3>
        <p>Quản trị viên</p>
    </div>
</div>

<table class="users-table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Tên đăng nhập</th>
            <th>Email</th>
            <th>Quyền</th>
            
            <th>Ngày tạo</th>
            <th>Hành động</th>
        </tr>
    </thead>
    <tbody>
        {% for user in users %}
        <tr class="{% if not user.is_active %}inactive-user{% endif %}">
            <td>{{ user.id }}</td>
            <td>
                <a href="{{ url_for('view_user', user_id=user.id) }}" class="user-link">
                    {{ user.username }}
                    {% if user.id == session.get('user_id') %}
                    <span class="badge badge-info">Bạn</span>
                    {% endif %}
                </a>
            </td>
            <td>{{ user.email }}</td>
            <td>
                {% if user.is_admin %}
                <span class="badge badge-admin">👑 Admin</span>
                {% else %}
                <span class="badge badge-user">👤 User</span>
                {% endif %}
            </td>
            
            <td>{{ user.created_at.strftime('%d/%m/%Y') }}</td>
            <td class="actions">
                <a href="{{ url_for('view_user', user_id=user.id) }}" class="btn btn-sm btn-info" title="Xem chi tiết">
                    👁️
                </a>
                
                {% if user.id != session.get('user_id') %}
                <a href="{{ url_for('toggle_user_active', user_id=user.id) }}" 
                   class="btn btn-sm {% if user.is_active %}btn-warning{% else %}btn-success{% endif %}"
                   onclick="return confirm('Bạn có chắc muốn {% if user.is_active %}khóa{% else %}kích hoạt{% endif %} tài khoản này?')"
                   title="{% if user.is_active %}Khóa{% else %}Kích hoạt{% endif %}">
                    {% if user.is_active %}🔒{% else %}🔓{% endif %}
                </a>
                
                <a href="{{ url_for('toggle_user_admin', user_id=user.id) }}" 
                   class="btn btn-sm {% if user.is_admin %}btn-secondary{% else %}btn-primary{% endif %}"
                   onclick="return confirm('Bạn có chắc muốn {% if user.is_admin %}gỡ quyền{% else %}cấp quyền{% endif %} admin?')"
                   title="{% if user.is_admin %}Gỡ quyền{% else %}Cấp quyền{% endif %} admin">
                    {% if user.is_admin %}👤{% else %}👑{% endif %}
                </a>
                
                <a href="{{ url_for('delete_user', user_id=user.id) }}" 
                   class="btn btn-sm btn-danger"
                   onclick="return confirm('⚠️ Bạn có chắc muốn XÓA VĨNH VIỄN tài khoản này?\n\nHành động này không thể hoàn tác!\n\n- Tất cả đơn hàng sẽ bị xóa\n- Giỏ hàng sẽ bị xóa')"
                   title="Xóa tài khoản">
                    🗑️
                </a>
                {% else %}
                <span class="text-muted">—</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<style>
.admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.stats-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1.5rem;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.stat-card h3 {
    font-size: 2rem;
    margin: 0 0 0.5rem 0;
}

.stat-card p {
    margin: 0;
    opacity: 0.9;
}

.users-table {
    width: 100%;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.users-table thead {
    background: #f8f9fa;
}

.users-table th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    color: #495057;
}

.users-table td {
    padding: 1rem;
    border-top: 1px solid #dee2e6;
}

.inactive-user {
    background-color: #fff3cd;
}

.user-link {
    color: #007bff;
    text-decoration: none;
    font-weight: 500;
}

.user-link:hover {
    text-decoration: underline;
}

.badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.85rem;
    font-weight: 500;
}

.badge-admin {
    background: #ffd700;
    color: #000;
}

.badge-user {
    background: #6c757d;
    color: white;
}

.badge-active {
    background: #28a745;
    color: white;
}

.badge-inactive {
    background: #dc3545;
    color: white;
}

.badge-info {
    background: #17a2b8;
    color: white;
    margin-left: 0.5rem;
}

.actions {
    white-space: nowrap;
}

.btn-sm {
    padding: 0.375rem 0.75rem;
    font-size: 0.9rem;
    margin-right: 0.25rem;
}
.btn {
    background: linear-gradient(135deg, #4661cf 0%, #3f63c7 100%);
}
.text-muted {
    color: #6c757d;
}
</style>
{% endblock %}