{% extends "base.html" %}

{% block content %}
<form class="search-form" method="GET">
    <input type="text" name="search" placeholder="T√¨m ki·∫øm s√°ch theo t√™n ho·∫∑c t√°c gi·∫£..." value="{{ search }}">
    <button type="submit" class="btn">üîç T√¨m ki·∫øm</button>
</form>

<!-- Hi·ªÉn th·ªã s·ªë k·∫øt qu·∫£ -->
{% if search %}
<div class="search-results-info">
    T√¨m th·∫•y <strong>{{ total }}</strong> k·∫øt qu·∫£ cho "<strong>{{ search }}</strong>"
</div>
{% endif %}

<div class="book-grid">
    {% for book in books %}
    <div class="book-card">
        <img src="{{ book.image_url }}" alt="{{ book.title }}" class="book-image" 
             onerror="this.src='https://images.unsplash.com/photo-1543002588-bfa74002ed7e?w=400'">
        <h3>{{ book.title }}</h3>
        <p><strong>T√°c gi·∫£:</strong> {{ book.author }}</p>
        <p>{{ book.description[:100] }}{% if book.description|length > 100 %}...{% endif %}</p>
        <div class="price">{{ "{:,.0f}".format(book.price) }} ƒë</div>
        <p class="stock">üìö C√≤n l·∫°i: {{ book.stock }} cu·ªën</p>
        {% if session.user_id %}
            <a href="{{ url_for('add_to_cart', book_id=book.id) }}" class="btn">üõí Th√™m v√†o gi·ªè</a>
        {% else %}
            <a href="{{ url_for('login') }}" class="btn">ƒêƒÉng nh·∫≠p ƒë·ªÉ mua</a>
        {% endif %}
    </div>
    {% else %}
    <p style="grid-column: 1/-1; text-align: center; color: white; font-size: 1.2rem;">
        Kh√¥ng t√¨m th·∫•y s√°ch n√†o.
    </p>
    {% endfor %}
</div>

<!-- Ph√¢n trang -->
{% if total_pages > 1 %}
<div class="pagination">
    <!-- N√∫t Previous -->
    {% if page > 1 %}
    <a href="?page={{ page - 1 }}{% if search %}&search={{ search }}{% endif %}" class="pagination-btn">
        <i class="fas fa-chevron-left"></i> Tr∆∞·ªõc
    </a>
    {% else %}
    <span class="pagination-btn disabled">
        <i class="fas fa-chevron-left"></i> Tr∆∞·ªõc
    </span>
    {% endif %}
    
    <!-- S·ªë trang -->
    <div class="pagination-numbers">
        {% if page > 3 %}
        <a href="?page=1{% if search %}&search={{ search }}{% endif %}" class="pagination-number">1</a>
        {% if page > 4 %}
        <span class="pagination-dots">...</span>
        {% endif %}
        {% endif %}
        
        {% for p in range([1, page - 2]|max, [total_pages + 1, page + 3]|min) %}
        {% if p == page %}
        <span class="pagination-number active">{{ p }}</span>
        {% else %}
        <a href="?page={{ p }}{% if search %}&search={{ search }}{% endif %}" class="pagination-number">{{ p }}</a>
        {% endif %}
        {% endfor %}
        
        {% if page < total_pages - 2 %}
        {% if page < total_pages - 3 %}
        <span class="pagination-dots">...</span>
        {% endif %}
        <a href="?page={{ total_pages }}{% if search %}&search={{ search }}{% endif %}" class="pagination-number">{{ total_pages }}</a>
        {% endif %}
    </div>
    
    <!-- N√∫t Next -->
    {% if page < total_pages %}
    <a href="?page={{ page + 1 }}{% if search %}&search={{ search }}{% endif %}" class="pagination-btn">
        Sau <i class="fas fa-chevron-right"></i>
    </a>
    {% else %}
    <span class="pagination-btn disabled">
        Sau <i class="fas fa-chevron-right"></i>
    </span>
    {% endif %}
</div>
{% endif %}

{% endblock %}